<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

<style>
#real-{{ section.id }} {
  {% if section.settings.outer_bg_image != blank %}
    background-image: url('{{ section.settings.outer_bg_image | image_url: width: 2000 }}');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  {% else %}
    background: {{ section.settings.outer_bg_color }};
  {% endif %}

  padding-top: {{ section.settings.padding_top_desktop }}px;
  padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
  overflow: hidden;
}

#real-{{ section.id }} .real-title {
  text-align: center;
  font-size: 42px;
  font-weight: 600;
  margin-bottom: 50px;
  color: {{ section.settings.title_color }};
}

#real-{{ section.id }} .real-dark {
  {% if section.settings.inner_bg_image != blank %}
    background-image: url('{{ section.settings.inner_bg_image | image_url: width: 2000 }}');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  {% else %}
    background: {{ section.settings.inner_bg_color }};
  {% endif %}

  padding: 60px 0;
}

/* Swiper */
#real-{{ section.id }} .swiper {
  width: 100%;
  padding-left: 40px;
}

#real-{{ section.id }} .swiper-slide {
  display: flex;
}

/* Card */
#real-{{ section.id }} .real-card {
  position: relative;
  width: 100%;
  height: auto;
  border-radius: 22px;
  overflow: hidden;
  background: #000;
  border: 2px solid rgba(255,255,255,0.15);
  box-shadow: 0 20px 40px rgba(0,0,0,.5);
}

#real-{{ section.id }} .real-card img,
#real-{{ section.id }} .real-card video {
  width: 100%;
  height: auto;
  display: block;
  object-fit: cover;
}

/* Overlay */
#real-{{ section.id }} .real-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 18px;
  pointer-events: none;
}

/* Text */
#real-{{ section.id }} .real-top {
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 1px;
  color: #fff;
}

#real-{{ section.id }} .real-bottom {
  font-size: 12px;
  color: #fff;
  line-height: 1.4;
}

/* Play button */
#real-{{ section.id }} .play-btn {
  position: absolute;
  bottom: 18px;
  right: 18px;
  width: 36px;
  height: 36px;
  background: rgba(255,255,255,0.9);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 20;
}

#real-{{ section.id }} .play-btn::after {
  content: "â–¶";
  font-size: 14px;
  margin-left: 2px;
  color: #000;
}

/* Responsive */
@media(max-width: 1024px){
  #real-{{ section.id }} {
    padding-top: {{ section.settings.padding_top_tablet }}px;
    padding-bottom: {{ section.settings.padding_bottom_tablet }}px;
  }
  #real-{{ section.id }} .real-title {
    font-size: 34px;
  }
}

@media(max-width: 768px){
  #real-{{ section.id }} {
    padding-top: {{ section.settings.padding_top_mobile }}px;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }

  #real-{{ section.id }} .real-title {
    font-size: 26px;
    margin-bottom: 25px;
  }

  #real-{{ section.id }} .swiper {
    padding-left: 20px;
  }

  #real-{{ section.id }} .real-dark {
    padding: 40px 0;
  }
}
</style>

<section id="real-{{ section.id }}">
  <h2 class="real-title">{{ section.settings.title }}</h2>

  <div class="real-dark">
    <div class="swiper realSwiper-{{ section.id }}">
      <div class="swiper-wrapper">

        {% for block in section.blocks %}
        <div class="swiper-slide">
          <div class="real-card">

            {% if block.settings.slide_type == 'image' %}
              {% if block.settings.image != blank %}
                <img src="{{ block.settings.image | image_url: width: 1200 }}" alt="">
              {% endif %}
            {% endif %}

            {% if block.settings.slide_type == 'video' %}
              {% if block.settings.video != blank %}

                <video class="real-video"
                  playsinline
                  muted
                  preload="metadata"
                  poster="{% if block.settings.video_thumbnail != blank %}{{ block.settings.video_thumbnail | image_url: width: 1200 }}{% endif %}">
                  {% for source in block.settings.video.sources %}
                    {% if source.mime_type == "video/mp4" %}
                      <source src="{{ source.url }}" type="video/mp4">
                    {% endif %}
                  {% endfor %}
                </video>

                <div class="play-btn"></div>

              {% endif %}
            {% endif %}

            <div class="real-overlay">
              <div class="real-top">{{ block.settings.heading }}</div>
              <div class="real-bottom">{{ block.settings.text }}</div>
            </div>

          </div>
        </div>
        {% endfor %}

      </div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){

  new Swiper(".realSwiper-{{ section.id }}", {
    slidesPerView: 2.5,
    spaceBetween: 30,
    centeredSlides: false,

    breakpoints: {
      0: {
        slidesPerView: 1.3,
        spaceBetween: 18
      },
      768: {
        slidesPerView: 2,
        spaceBetween: 25
      },
      1024: {
        slidesPerView: 2.5,
        spaceBetween: 30
      }
    }
  });

  function pauseAllVideos(){
    document.querySelectorAll("#real-{{ section.id }} video").forEach(v => {
      v.pause();
      v.currentTime = 0;
      v.removeAttribute("controls");
    });

    document.querySelectorAll("#real-{{ section.id }} .play-btn").forEach(btn => {
      btn.style.display = "flex";
    });
  }

  document.querySelectorAll("#real-{{ section.id }} .real-card").forEach(card => {
    const video = card.querySelector("video");
    const btn = card.querySelector(".play-btn");

    if(video && btn){

      btn.addEventListener("click", function(e){
        e.preventDefault();
        e.stopPropagation();

        pauseAllVideos();

        // hide button
        btn.style.display = "none";

        // remove thumbnail (poster) after click
        video.removeAttribute("poster");

        // add controls after click
        video.setAttribute("controls", "controls");

        // force reload
        video.load();

        // play
        const playPromise = video.play();

        if(playPromise !== undefined){
          playPromise.then(() => {
            // success
          }).catch((error) => {
            console.log("Video play blocked:", error);
            btn.style.display = "flex";
          });
        }
      });

      video.addEventListener("pause", function(){
        btn.style.display = "flex";
      });

      video.addEventListener("ended", function(){
        btn.style.display = "flex";
      });

    }
  });

});
</script>

{% schema %}
{
  "name": "Real Routine Slider",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Built Into Real Routines"
    },

    {
      "type": "color",
      "id": "outer_bg_color",
      "label": "Outer Background Color",
      "default": "#e9eef5"
    },
    {
      "type": "image_picker",
      "id": "outer_bg_image",
      "label": "Outer Background Image"
    },

    {
      "type": "color",
      "id": "inner_bg_color",
      "label": "Inner Background Color",
      "default": "#000000"
    },
    {
      "type": "image_picker",
      "id": "inner_bg_image",
      "label": "Inner Background Image"
    },

    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#111111"
    },

    {
      "type": "range",
      "id": "padding_top_desktop",
      "label": "Padding Top Desktop",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "label": "Padding Bottom Desktop",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 80
    },

    {
      "type": "range",
      "id": "padding_top_tablet",
      "label": "Padding Top Tablet",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom_tablet",
      "label": "Padding Bottom Tablet",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 60
    },

    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Padding Top Mobile",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Padding Bottom Mobile",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 40
    }
  ],

  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "select",
          "id": "slide_type",
          "label": "Slide Type",
          "default": "image",
          "options": [
            { "value": "image", "label": "Image" },
            { "value": "video", "label": "Video" }
          ]
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Shopify Hosted Video"
        },
        {
          "type": "image_picker",
          "id": "video_thumbnail",
          "label": "Video Thumbnail (Poster)"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Top Label",
          "default": "WHAT THIS IS"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Bottom Text",
          "default": "This isn't an energy drink. It's productivity."
        }
      ]
    }
  ],

  "presets": [
    {
      "name": "Real Routine Slider",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}